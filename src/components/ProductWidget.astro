---
import { getEntry } from 'astro:content';

// 1. Принимаем данные (prop называется item, как мы выяснили из базы)
const { item } = Astro.props;

// 2. Логика: ищем товар
let product = null;
let slug = null;

if (item) {
  const entry = await getEntry('products', item);
  if (entry) {
    product = entry.data;
    slug = entry.slug;
  }
}
---

{/* ВАРИАНТ 1: Если товара нет — выводим ошибку для дебага (только в dev режиме или стилизованную) */}
{ !product && (
  <div class="my-6 p-4 border-l-4 border-red-500 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 font-mono text-sm">
    <strong>WIDGET ERROR:</strong> Товар с ID "{item}" не найден.
  </div>
)}

{/* ВАРИАНТ 2: Если товар есть — рисуем красивую карточку */}
{ product && (
  <div class="not-prose my-8 flex items-center gap-4 rounded-lg border border-neutral-200 bg-white p-4 shadow-sm transition-colors dark:border-white/10 dark:bg-neutral-900">
    
    {/* Картинка */}
    {product.images && product.images[0] && (
      <img 
        src={product.images[0]} 
        alt={product.title} 
        class="h-20 w-20 shrink-0 rounded-md object-cover"
      />
    )}

    {/* Текст */}
    <div class="min-w-0 flex-1">
      <h4 class="m-0 mb-1 truncate text-base font-semibold text-neutral-900 dark:text-white">
        {product.title}
      </h4>
      <p class="m-0 text-sm font-bold text-amber-600 dark:text-amber-500">
        {product.price} ₽
      </p>
    </div>

    {/* Кнопка */}
    <a 
      href={`/products/${slug}`} 
      class="shrink-0 rounded-md bg-neutral-900 px-4 py-2 text-sm font-medium text-white no-underline transition-colors hover:bg-neutral-700 dark:bg-white dark:text-neutral-900 dark:hover:bg-neutral-200"
    >
      Купить
    </a>

  </div>
)}