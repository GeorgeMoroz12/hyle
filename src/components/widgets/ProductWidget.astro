---
import { getEntry } from 'astro:content';

const { item } = Astro.props;
let productEntry = null;
let productData = null;

if (item && typeof item === 'string') {
    try {
        productEntry = await getEntry('products', item);
        if (productEntry) {
            productData = productEntry.data;
        }
    } catch (e) {
        console.warn('Widget Error');
    }
}

const mainImage = productData?.images?.[0] || '/images/placeholder.jpg';
const slug = productEntry?.slug || '#';
---

{ !productData && (
    <div class="p-4 border border-red-500 text-red-500 not-prose">
        Widget Error: Product "{item}" not found.
    </div>
)}

{ productData && (
    <div class="not-prose my-8 p-4 border rounded flex gap-4 bg-white items-center shadow-sm">
        <img src={mainImage} class="w-20 h-20 object-cover rounded" alt={productData.title} />
        <div class="flex-1">
             <h4 class="font-bold m-0 text-lg">{productData.title}</h4>
             <p class="text-orange-600 font-bold m-0">{productData.price} ₽</p>
        </div>
        <a href={'/products/' + slug} class="bg-black text-white px-4 py-2 rounded no-underline text-sm">
            Купить
        </a>
    </div>
)}
