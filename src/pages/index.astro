---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import ProductCard from '../components/ProductCard.astro';
import { getCollection } from 'astro:content';

const HERO_IMAGE = "/images/hero-minimal.jpg";       
const WORKSHOP_IMAGE = "/images/workshop-process.jpg"; 

const allProducts = await getCollection('products');
const recentProducts = allProducts.slice(0, 4); 

const allCategories = await getCollection('categories');
const categoryMap = allCategories.reduce((acc, cat) => {
    acc[cat.id] = cat.data.title;
    return acc;
}, {} as Record<string, string>);
---

<Layout title="Главная" hideHeader={true}>
  
  <!-- HEADER (Custom Absolute) -->
  <nav class="absolute top-0 left-0 w-full z-50 px-6 py-6 md:px-12 flex justify-between items-start mix-blend-difference text-hyle-text lg:mix-blend-normal">
      <!-- Логотип -->
      <a href="/" class="flex flex-col gap-1 group">
          <span class="font-serif text-3xl md:text-4xl leading-none text-hyle-text group-hover:text-hyle-clay transition-colors">Hyle.</span>
      </a>
      
      <!-- Десктоп меню -->
      <div class="hidden md:flex gap-12 font-mono text-xs tracking-widest text-hyle-text/80 uppercase">
          <a href="/catalog" class="hover:text-hyle-clay transition-colors">Каталог</a>
          <a href="/about" class="hover:text-hyle-clay transition-colors">Мастерская</a>
      </div>

      <!-- Мобильное меню -->
      <button class="md:hidden text-current">
          <span class="font-mono text-xs uppercase">Menu</span>
      </button>
  </nav>

  <!-- HERO SECTION: ARCHITECTURAL SPLIT -->
  <section class="relative h-screen w-full flex flex-col lg:flex-row overflow-hidden bg-hyle-bg">
    
    <!-- LEFT COLUMN: CONTENT (55%) -->
    <div class="w-full lg:w-[55%] h-[60%] lg:h-full relative flex flex-col justify-end p-6 md:p-12 lg:p-16 border-r border-hyle-text/10">
        
        <!-- Technical Label Top-Left -->
        <div class="absolute top-32 left-6 md:left-12 lg:left-16 hidden lg:block">
            <p class="font-mono text-[10px] text-hyle-text/40 flex flex-col gap-1">
                <span>EST. 2026</span>
                <span>MOSCOW, RU</span>
                <span>CLAY / FIRE / HANDS</span>
            </p>
        </div>

        <div class="animate-appear max-w-2xl z-10">
            <!-- Main Title -->
            <h1 class="font-serif text-6xl md:text-8xl lg:text-[7.5vw] leading-[0.9] lg:leading-[0.85] text-hyle-text mb-8 md:mb-12 tracking-tight">
                Глина <br/>
                <span class="italic text-hyle-clay font-light ml-12 lg:ml-24">хранит</span> <br/>
                тепло.
            </h1>

            <!-- Description & CTA -->
            <div class="flex flex-col md:flex-row gap-8 md:items-end border-t border-hyle-text/10 pt-8 w-full">
                <p class="font-sans font-light text-sm md:text-base text-hyle-text/70 max-w-xs leading-relaxed">
                    Посуда, созданная в тишине. <br/>
                    С несовершенствами, которые делают ее живой.
                </p>
                
                <a href="/catalog" class="group flex items-center gap-3">
                    <span class="font-mono text-xs uppercase tracking-widest border-b border-hyle-text group-hover:border-hyle-clay group-hover:text-hyle-clay transition-all pb-1">
                        Перейти в каталог
                    </span>
                    <span class="text-hyle-clay transform group-hover:translate-x-1 transition-transform">→</span>
                </a>
            </div>
        </div>
    </div>

    <!-- RIGHT COLUMN: IMAGE (45%) -->
    <div class="w-full lg:w-[45%] h-[40%] lg:h-full relative overflow-hidden bg-hyle-stone/20">
        <!-- Image: Hard Cut, No Gradient -->
        <img 
            src={HERO_IMAGE} 
            alt="Ceramic Texture" 
            class="w-full h-full object-cover object-center transform scale-105 transition-transform duration-[2s] hover:scale-100"
            onerror="this.src='https://images.unsplash.com/photo-1595180665183-c21d0a519894?q=80&w=1600&auto=format&fit=crop'"
        />
        
        <!-- Decorative Sticker / Stamp -->
        <div class="absolute bottom-6 left-6 bg-[#F9F8F6] p-4 max-w-[140px] hidden lg:block shadow-lg">
            <p class="font-mono text-[9px] text-hyle-text/60 leading-tight uppercase">
                Collection <br/>
                <span class="text-hyle-text font-bold text-lg block my-1">Raw 26</span>
                Limited Ed.
            </p>
        </div>
    </div>

  </section>

  <!-- SECTION 2: CATALOG TEASER -->
  <section class="py-24 md:py-32 relative bg-hyle-bg">
    <div class="container-main">
        <div class="flex flex-col md:flex-row justify-between items-end mb-16 md:mb-24 gap-6 border-b border-hyle-text/10 pb-6">
            <div>
                <span class="font-mono text-[10px] uppercase text-hyle-text/40 mb-2 block">01 / Showcase</span>
                <h2 class="font-serif text-4xl md:text-5xl text-hyle-text">Новое из печи</h2>
            </div>
            <a href="/catalog" class="font-mono text-xs uppercase tracking-widest text-hyle-text/60 hover:text-hyle-clay transition-colors">
                Смотреть всё [ {allProducts.length} ]
            </a>
        </div>

        <div class="grid grid-cols-2 lg:grid-cols-4 gap-x-4 gap-y-12 md:gap-x-8">
            {recentProducts.map((product) => {
                const catId = (product.data.category && typeof product.data.category === 'object') 
                    ? product.data.category.id 
                    : product.data.category;
                return (
                    <ProductCard 
                        product={product} 
                        categoryName={catId ? categoryMap[catId] : ''} 
                    />
                );
            })}
        </div>
    </div>
  </section>

  <!-- SECTION 3: ATMOSPHERE (Workshop) -->
  <section class="bg-[#1A1918] text-[#F9F8F6] py-24 md:py-40 relative overflow-hidden">
      <!-- Grain Overlay -->
      <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] mix-blend-overlay pointer-events-none"></div>
      
      <div class="container-main relative z-10 grid grid-cols-1 lg:grid-cols-2 gap-16 items-center">
          <!-- Text -->
          <div class="order-2 lg:order-1 flex flex-col items-start">
              <span class="font-mono text-xs text-hyle-clay mb-6">02 / Philosophy</span>
              <h2 class="font-serif text-4xl md:text-6xl mb-8 leading-tight">
                  Красота в <br/> <span class="italic font-light opacity-80">несовершенстве.</span>
              </h2>
              <p class="font-sans font-light text-white/60 text-lg leading-relaxed max-w-md mb-10">
                  Мы не прячем следы рук. Не зашлифовываем случайные линии. 
                  Каждая трещинка глазури — это история обжига, которую нельзя повторить.
              </p>
              <a href="/about" class="inline-block border border-white/20 px-8 py-4 font-mono text-xs uppercase tracking-widest hover:bg-white hover:text-black transition-colors duration-300">
                  О мастерской
              </a>
          </div>

          <!-- Image -->
          <div class="order-1 lg:order-2 relative aspect-[4/5] bg-white/5 p-2">
              <div class="w-full h-full overflow-hidden relative">
                  <img 
                    src={WORKSHOP_IMAGE} 
                    alt="Process" 
                    class="w-full h-full object-cover grayscale opacity-80 hover:opacity-100 hover:grayscale-0 transition-all duration-1000"
                  />
                  <!-- Vertical Line Decor -->
                  <div class="absolute top-0 right-8 w-px h-full bg-white/10"></div>
              </div>
          </div>
      </div>
  </section>

  <!-- FOOTER (Clean & Grey) -->
  <footer class="bg-hyle-stone/20 py-16 border-t border-hyle-text/5">
      <div class="container-main grid grid-cols-1 md:grid-cols-4 gap-12">
          <div class="md:col-span-2">
              <a href="/" class="font-serif text-2xl block mb-6">Hyle.</a>
              <p class="font-sans font-light text-sm text-hyle-text/60 max-w-xs">
                  Керамика ручной работы, вдохновленная природой и тишиной.
              </p>
          </div>
          
          <div>
              <h4 class="font-mono text-[10px] uppercase text-hyle-text/40 mb-4">Меню</h4>
              <ul class="flex flex-col gap-3 text-sm font-light text-hyle-text/80">
                  <li><a href="/catalog" class="hover:text-hyle-clay">Каталог</a></li>
                  <li><a href="/about" class="hover:text-hyle-clay">Мастерская</a></li>
                  <li><a href="/blog" class="hover:text-hyle-clay">Журнал</a></li>
              </ul>
          </div>

          <div>
              <h4 class="font-mono text-[10px] uppercase text-hyle-text/40 mb-4">Контакты</h4>
              <ul class="flex flex-col gap-3 text-sm font-light text-hyle-text/80">
                  <li><a href="#" class="hover:text-hyle-clay">Telegram</a></li>
                  <li><a href="#" class="hover:text-hyle-clay">Instagram</a></li>
                  <li class="mt-4 text-xs text-hyle-text/40">© 2026 Hyle Ceramics</li>
              </ul>
          </div>
      </div>
  </footer>

</Layout>